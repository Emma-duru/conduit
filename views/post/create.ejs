<%- include("../layout/header") %> 

<div class="d-flex justify-content-center mt-4">
<!-- Default form contact -->
<form class="text-center p-5 col-lg-9" id="create-form">

    <p class="h4 mb-4">Create Post</p>

    <!-- Name -->
    <div class="mb-4">
        <input type="text" name="title" class="form-control" placeholder="Post Title">
        <small class="text-danger title-error"></small>
    </div>
    

    <div class="mb-4">
        <input type="text" name="description" class="form-control" placeholder="Post Description">
        <small class="text-danger description-error"></small>
    </div>
    <!-- Email -->
    
    <div class="mb-4">
        <textarea class="form-control rounded-0" name="body" rows="3" placeholder="Post Body"></textarea>
        <small class="text-danger body-error"></small>
    </div>
   
    <!-- Send button -->
    <button class="btn btn-info btn-block" type="submit">Create Post</button>

</form>
<!-- Default form contact -->
</div>


<script>
    const form = document.querySelector("#create-form");
    const titleError = document.querySelector(".title-error");
    const descError = document.querySelector(".description-error");
    const bodyError = document.querySelector(".body-error")

    form.addEventListener("submit", async (e) => {
        e.preventDefault()

        titleError.textContent = "";
        descError.textContent = "";
        bodyError.textContent = "";

        const title = form.title.value;
        const description = form.description.value;
        const body = form.body.value;

        try {
            const res = await fetch("/create", {
                method: 'POST',
                body: JSON.stringify({ title, description, body }),
                headers: {"Content-Type": "application/json"}
            })
            const data = await res.json()

            if (data.post) {
                location.assign("/<%= user.username %>")
            }
            if (data.errors) {
                console.log(data.errors)
            }
        } catch(err) {
            console.log(err)
        }
    })

    

</script>


<%- include("../layout/footer") %> 